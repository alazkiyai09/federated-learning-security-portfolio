# Base Configuration for Privacy-Preserving FL Fraud Detection

defaults:
  - model: lstm
  - strategy: fedavg
  - override hydra/launcher: basic

# Project Settings
project:
  name: privacy_preserving_fl_fraud
  version: 0.1.0
  random_seed: 42

# Data Configuration
data:
  raw_path: ${oc.env:DATA_PATH,./data/processed}
  num_features: ${oc.env:NUM_FEATURES,30}
  sequence_length: ${oc.env:SEQUENCE_LENGTH,10}
  batch_size: ${oc.env:BATCH_SIZE,32}
  train_split: 0.8
  val_split: 0.1
  test_split: 0.1

  # Partitioning
  n_clients: ${oc.env:NUM_CLIENTS,10}
  partition_type: dirichlet  # Options: dirichlet, pathological
  dirichlet_alpha: 0.5  # Lower = more non-IID

  # Preprocessing
  scaling_method: standard  # Options: standard, minmax, robust
  handle_imbalance: true
  sampling_strategy: auto  # For imbalanced data

# Model Configuration
model:
  type: ${oc.env:MODEL_TYPE,lstm}
  input_size: ${data.num_features}
  hidden_size: 128
  num_layers: 2
  dropout: 0.2
  output_size: 2  # Binary classification
  learning_rate: 0.001

# Federated Learning Configuration
fl:
  server_address: ${oc.env:SERVER_ADDRESS,0.0.0.0}
  server_port: ${oc.env:SERVER_PORT,8080}
  n_rounds: ${oc.env:NUM_ROUNDS,100}
  client_timeout: 600  # seconds
  min_fit_clients: 8
  min_evaluate_clients: 8
  min_available_clients: 10

  # Local training
  local_epochs: 5
  batch_size: ${data.batch_size}

  # Checkpointing
  checkpoint_frequency: ${oc.env:CHECKPOINT_FREQUENCY,5}
  checkpoint_dir: ./models/checkpoints

# Privacy Configuration
privacy:
  # Differential Privacy
  dp_enabled: ${oc.env:DP_ENABLED,true}
  epsilon: ${oc.env:DEFAULT_EPSILON,1.0}
  delta: ${oc.env:DEFAULT_DELTA,1e-5}
  max_grad_norm: 1.0
  noise_multiplier: 0.1

  # Secure Aggregation
  secure_agg_enabled: ${oc.env:SECURE_AGGREGATION_ENABLED,false}
  bit_size: 32

# Security Configuration
security:
  # SignGuard Defense
  signguard_enabled: ${oc.env:SIGNGUARD_ENABLED,true}
  signguard_threshold: ${oc.env:ANOMALY_THRESHOLD,0.1}

  # Attack Detection
  attack_detection_enabled: ${oc.env:ATTACK_DETECTION_ENABLED,true}
  anomaly_detection:
    method: statistical  # Options: statistical, ml, hybrid
    window_size: 10
    std_threshold: 2.0

  # Alerting
  alert_on_attack: true
  alert_channel: log  # Options: log, email, webhook

# Serving Configuration
serving:
  api_host: ${oc.env:API_HOST,0.0.0.0}
  api_port: ${oc.env:API_PORT,8000}
  api_workers: ${oc.env:API_WORKERS,4}
  model_store_path: ${oc.env:MODEL_STORE_PATH,./models}
  max_model_versions: 5

# MLOps Configuration
mlops:
  mlflow_enabled: true
  mlflow_tracking_uri: ${oc.env:MLFLOW_TRACKING_URI,http://localhost:5000}
  mlflow_experiment_name: ${oc.env:MLFLOW_EXPERIMENT_NAME,fraud_detection_fl}

  # Metrics to track
  track_metrics:
    - accuracy
    - precision
    - recall
    - f1
    - auc_roc
    - auprc

  # Logging
  log_frequency: 1  # Log every N rounds

# Logging Configuration
logging:
  level: ${oc.env:LOG_LEVEL,INFO}
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: ${oc.env:LOG_FILE,./logs/app.log}
  rotation: 10 MB
  retention: 7 days

# Hardware Configuration
device: cuda  # Options: cuda, cpu, mps
num_workers: 4
pin_memory: true
